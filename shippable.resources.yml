# This resources are only used for Video Service 

####################################################################
# Refer to http://docs.shippable.com/reference/resources-overview/ #
####################################################################

resources:

  - name: video-service-docker-opts
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 128
      portMappings:
        - 0:3000
      publishAllPorts : true
      logConfig:
        type: awslogs
        options:
          awslogs-group: "app_ecs"
          awslogs-region: "ap-southeast-2"
          awslogs-stream-prefix: "video-service"

  - name: video-service-repo
    type: gitRepo
    integration: production-github
    pointer:
      sourceName: bauerxcelmedia/video-service
      branch: master

  # Slack connection
  - name: video-slack-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#au-shippable"
        
  # Slack connection
  - name: video-service-deployment-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#au-shippable"

  - name: video-service-master-docker-registry
    type: image
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/video-service"
    seed:
      versionName: "master.16"

  - name: video-service-branch-docker-registry
    type: image
    pointer:
      sourceName: "317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/video-service"
    seed:
      versionName: latest

  # Seed Release version
    # for Rollback refer to below URL
    # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: video-service-version
    type: version
    seed:
      versionName: "1.0.0"

  ####################################
  # NON PROD environment configuration
  ####################################

  - name: video-service-sit-ecs
    type: cluster
    integration: digital-nonprod-AWS
    pointer:
      sourceName : "app_ecs"
      region: "ap-southeast-2"

  - name: video-service-sit-alb
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/video-service-sit/9ec2235d3fc1182c"
      method: application

  - name: video-service-sit-alb-branch
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/video-service-branch-sit/799db1718497881d"
      method: application

  - name: video-service-sit-params
    type: params
    version:
      params:
        NODE_ENV: "dev"
        APP_ENV: "sit"
        APM_KEY: "c777240932e6282ffacc6a42ae6a0709426522bb"
        #JWP_MANAGEMENT_KEY_ID JWP_MANAGEMENT_SECRET
        secure: MTo/ffCawGjeVJBnHM1oYtgeWd6g1OwDx0cFqt3ilrrirMhoNys1jTv1hqLUytHpPlGnYD8AAT7ukeyDo5GVwNGcNeDbjo6N8Ujr2QLi99d4jhtupF9fD6s5sj918k0udNgzk2NkUm/t0fPAW9TyPc+zUCibp5qLBiOvtomJJONt6yOC3teS9aNzrAQYSJTi5lJEdD/svW5fPWwVsRW+RjHIufi10t5NnZAgk5XVKQWbZ38igoJRksUqlnG1LTH2zaKpxR1IgT0cIQpOfdRjzZm22/Y2XEzXOj+RlfGLYH3jRIlB7+xhSIJYAX0kNr3YoKlsjoLaiIl9aXFPvh1J1Q==

  ####################################
  # PROD environment configuration
  ####################################

  - name: video-service-prod-ecs
    type: cluster
    integration: digital-prod-AWS
    pointer:
      sourceName : "app_ecs"
      region: "ap-southeast-2"

  - name: video-service-prod-alb
    type: loadBalancer
    pointer:
      sourceName: "arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/video-service-prod/1f997bcd4dbd4aa1"
      method: application

  - name: video-service-prod-params
    type: params
    version:
      params:
        NODE_ENV: "production"
        APP_ENV: "prod"
        APM_KEY: "c777240932e6282ffacc6a42ae6a0709426522bb"
        #JWP_MANAGEMENT_KEY_ID JWP_MANAGEMENT_SECRET
        secure: eQ+VBIgiwDh2kZq44Kv4ZemzAHLH30ZI6NLBAtXUXAm1UkzjKt55jSGfCfGXuHSrGv7pD2EZh7BBqh4BAZNVznI4nqRafvRwUTq7HPjs7GcwFRc5r15flf286zkO5tppVCl8RZZI0JyIt3mj5PfwP9MISu7eN+2r4Czng+TrxKIE4NINANWZqpxBNJ9q6PQMCaubG1gQvZGjb263c+59AAYzkk7aevaHjaRwYQJZ87NyN6Ma3nV2JDx1gT1dWM2tqbObS3CYzqn4c6z5L0nkzq5Lvn9Gqr4ZQNqebMGHy133jMeCTavzUBIwpaiVyVYDhUekPNQ7KRbKAhJD300Uqw==
